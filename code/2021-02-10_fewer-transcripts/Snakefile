# ==============================================================================
# Configuration
# ==============================================================================
import pandas as pd
import os.path as path

RESULT_DIR = path.join("..", "..", "results", "2021-02-10_fewer-transcripts")
PLOT_DIR = path.join(RESULT_DIR, "Plots")

N_ITERS = 30

# ==============================================================================
# Meta Rules
# ==============================================================================
rule all:
	input:
		# SWI/SNF complex subunits
		expand(
			path.join(RESULT_DIR, "Iterations", "SWI-SNF", "balanced", "{i}.{ext}"),
			i=range(1, N_ITERS + 1),
			ext=["genes.tsv", "sleuth-object.rds"],
		),
		expand(
			path.join(RESULT_DIR, "Iterations", "SWI-SNF", "unbalanced", "{i}.{method}.{ext}"),
			i=range(1, N_ITERS + 1),
			method=["ols", "jse"],
			ext=["genes.tsv", "sleuth-object.rds", "design.tsv"],
		),
		# randomly selected transcripts
		expand(
			path.join(RESULT_DIR, "Iterations", "random", "total_{n}", "iter_{i}.balanced.{ext}"),
			n=[3, 10, 25, 50, 100, 250, 500, 1000],
			i=range(1, N_ITERS + 1),
			ext=["genes.tsv", "sleuth-object.rds", "design.tsv"],
		),
		expand(
			path.join(RESULT_DIR, "Iterations", "random", "total_{n}", "iter_{i}.unbalanced-{method}.{ext}"),
			n=[3, 10, 25, 50, 100, 250, 500, 1000],
			i=range(1, N_ITERS + 1),
			method=["ols", "jse"],
			ext=["genes.tsv", "sleuth-object.rds", "design.tsv"],
		),

# ==============================================================================
# Rules
# ==============================================================================
rule sleuth_small_swi_snf:
	input:
		script = "calc-swi-snf-sleuth.R",
	output:
		expand(
			path.join(RESULT_DIR, "Iterations", "SWI-SNF", "balanced", "{i}.{ext}"),
			i=range(1, N_ITERS + 1),
			ext=["genes.tsv", "sleuth-object.rds"],
		),
		expand(
			path.join(RESULT_DIR, "Iterations", "SWI-SNF", "unbalanced", "{i}.{method}.{ext}"),
			i=range(1, N_ITERS + 1),
			method=["ols", "jse"],
			ext=["genes.tsv", "sleuth-object.rds", "design.tsv"],
		),
	shell:
		"Rscript {input.script}"

rule sleuth_small_random:
	input:
		script = "calc-random-sleuth.R",
	output:
		expand(
			path.join(RESULT_DIR, "Iterations", "random", "total_{{n}}", "iter_{i}.balanced.{ext}"),
			i=range(1, N_ITERS + 1),
			ext=["genes.tsv", "sleuth-object.rds", "design.tsv"],
		),
		expand(
			path.join(RESULT_DIR, "Iterations", "random", "total_{{n}}", "iter_{i}.unbalanced-{method}.{ext}"),
			i=range(1, N_ITERS + 1),
			method=["ols", "jse"],
			ext=["genes.tsv", "sleuth-object.rds", "design.tsv"],
		),
	shell:
		"Rscript {input.script} {wildcards.n}"

