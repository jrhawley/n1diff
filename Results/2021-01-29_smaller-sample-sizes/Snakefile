# ==============================================================================
# Configuration
# ==============================================================================
import pandas as pd
import os.path as path

# ==============================================================================
# Meta Rules
# ==============================================================================
rule all:
	input:
		expand(
			path.join("Plots", "{plot}.png"),
			plot=[
				"ACC",
				"MCC",
				"NPV",
				"PPV",
				"TNR",
				"TPR",
				"confusion",
				"mse.all"
			],
		)

# ==============================================================================
# Rules
# ==============================================================================
rule sleuth_small_n:
	input:
		script = "sleuth.shuffle.R",
	output:
		expand(
			"Iterations/Total_{{n}}/balanced/{i}.{file}",
			i=range(1, 11),
			file=["genes.tsv", "sleuth-object.rds"],
		),
		expand(
			"Iterations/Total_{{n}}/unbalanced/{i}.{file}",
			i=range(1, 11),
			file=["genes.tsv", "sleuth-object.rds"],
		),
		expand(
			"Iterations/Total_{{n}}/unbalanced/{i}.{file}",
			i=range(1, 11),
			file=["genes.jse.tsv", "jse-object.rds"],
		),
	shell:
		"Rscript {input.script} {wildcards.n}"

rule calc_rates:
	input:
		script = "compare-smaller-sample-sizes.R",
		data = expand(
			"Iterations/Total_{n}/unbalanced/{i}.{ext}",
			n=range(4, 25, 2),
			i=range(1, 11),
			ext=["genes.tsv", "sleuth-object.rds", "genes.jse.tsv", "jse-object.rds"],
		),
	output:
		path.join("Comparison", "tests.tsv"),
		path.join("Comparison", "confusion.tsv"),
		path.join("Comparison", "rates.tsv"),
		path.join("Comparison", "jse-comp-coeffs.tsv"),
		path.join("Comparison", "mse.by-transcript.tsv"),
		path.join("Comparison", "mse.all.tsv"),
		path.join("Comparison", "roc.tsv"),
		path.join("Comparison", "prc.tsv"),
	shell:
		"Rscript {input.script}"

rule plot_rates:
	input:
		script = "plot-sleuth.R",
		conf = path.join("Comparison", "confusion.tsv"),
		rates = path.join("Comparison", "rates.tsv"),
		mse = path.join("Comparison", "mse.all.tsv"),
		roc = path.join("Comparison", "roc.tsv"),
		prc = path.join("Comparison", "prc.tsv"),
	output:
		path.join("Plots", "ACC.png"),
		path.join("Plots", "MCC.png"),
		path.join("Plots", "NPV.png"),
		path.join("Plots", "PPV.png"),
		path.join("Plots", "TNR.png"),
		path.join("Plots", "TPR.png"),
		path.join("Plots", "confusion.png"),
		path.join("Plots", "mse.all.png"),
	shell:
		"Rscript {input.script}"
